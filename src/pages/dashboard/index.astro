---
import Layout from "@/layouts/Dashboard.astro";
import Navigation from "@/components/Navigation.astro";
import PageHeader from "@/components/ui/PageHeader.astro";
import Card from "@/components/ui/Card.astro";
import { ProfileService } from "@/services/ProfileService";
import { ClientService } from "@/services/ClientService";
import { TemplateService } from "@/services/TemplateService";

const { user } = Astro.locals;

if (!user) {
  return Astro.redirect("/auth/signin");
}

const profile = await ProfileService.getProfile(user.id);
const clients = await ClientService.getClients(user.id);
const contractTemplates = await TemplateService.getContractTemplates(user.id);
const questionnaireTemplates = await TemplateService.getQuestionnaireTemplates(
  user.id,
);

const totalClients = clients?.length || 0;
const pendingClients =
  clients?.filter((c) => c.status === "pending").length || 0;
const completedClients =
  clients?.filter((c) => c.status === "completed").length || 0;
---

<Layout title="Dashboard">
  <Navigation currentPage="dashboard" />

  <main class="flex-1 ml-60 p-16">
    <PageHeader
      title={profile?.firm_name || "Panel de Control"}
      subtitle="Vista general de tu despacho"
    />

    <section class="grid grid-cols-3 gap-8 mb-16">
      <Card hover>
        <div class="text-5xl font-extralight text-content-primary mb-2">
          {totalClients}
        </div>
        <div
          class="text-xs font-light tracking-widest uppercase text-content-secondary"
        >
          Total Clientes
        </div>
      </Card>

      <Card hover>
        <div class="text-5xl font-extralight text-content-primary mb-2">
          {pendingClients}
        </div>
        <div
          class="text-xs font-light tracking-widest uppercase text-content-secondary"
        >
          Pendientes
        </div>
      </Card>

      <Card hover>
        <div class="text-5xl font-extralight text-content-primary mb-2">
          {completedClients}
        </div>
        <div
          class="text-xs font-light tracking-widest uppercase text-content-secondary"
        >
          Completados
        </div>
      </Card>
    </section>

    <section class="flex gap-16 mb-16 py-8 border-y border-border-weak">
      <div class="flex items-baseline gap-4">
        <span class="text-3xl font-extralight text-content-primary">
          {contractTemplates?.length || 0}
        </span>
        <span class="text-sm font-light text-content-secondary">
          Plantillas de Contratos
        </span>
      </div>
      <div class="flex items-baseline gap-4">
        <span class="text-3xl font-extralight text-content-primary">
          {questionnaireTemplates?.length || 0}
        </span>
        <span class="text-sm font-light text-content-secondary">
          Plantillas de Cuestionarios
        </span>
      </div>
    </section>

    <section class="mt-16">
      <h2
        class="text-sm font-light tracking-widest uppercase text-content-secondary mb-8"
      >
        Acciones
      </h2>
      <div class="grid grid-cols-3 gap-6">
        <a
          href="/dashboard/clients/new"
          class="bg-surface-highlight/50 border border-border-strong rounded p-8 text-center transition-all duration-300 hover:bg-surface-highlight hover:border-border-strong hover:-translate-y-0.5"
        >
          <span class="text-sm font-light tracking-zen text-content-primary">
            Nueva Sala de Bienvenida
          </span>
        </a>
        <a
          href="/dashboard/clients"
          class="bg-transparent border border-border-weak rounded p-8 text-center transition-all duration-300 hover:bg-surface-highlight hover:border-border"
        >
          <span class="text-sm font-light tracking-zen text-content-primary/80">
            Ver Clientes
          </span>
        </a>
        <a
          href="/dashboard/profile"
          class="bg-transparent border border-border-weak rounded p-8 text-center transition-all duration-300 hover:bg-surface-highlight hover:border-border"
        >
          <span class="text-sm font-light tracking-zen text-content-primary/80">
            Configurar Despacho
          </span>
        </a>
      </div>
    </section>
  </main>
</Layout>
